{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/mypage/profile.css' %}">

<div class="profile-container">
    <div class="profile-header">
        <div class="profile-image">
            {% if profile_user.profile_image %}
                <img src="{{ profile_user.profile_image.url }}" alt="{{ profile_user.username }}ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€">
            {% else %}
                {% if user.profile_image %}
                    <img src="{{ user.profile_image.url }}" alt="Profile Image">
                {% else %}
                    <i class="fas fa-user"></i>
                {% endif %}
            {% endif %}
        </div>
        <div class="profile-info">
            <h1>ğŸ€{{ profile_user.cohort }}ê¸° í”¼ë¡œê·¸ë˜ë¨¸ {{ profile_user.username }}ğŸ€</h1>
            <p>{{ profile_user.intro|default_if_none:"ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤." }}</p>
        </div>
    </div>

    <div class="profile-activities">
        <div class="activity-filter">
            <a href="#" class="filter-link active" data-category="all">All</a>
            <a href="#" class="filter-link" data-category="review">review</a>
            <a href="#" class="filter-link" data-category="corboard">cooperation</a>
            <a href="#" class="filter-link" data-category="trend">ITtrend</a>
        </div>

        <div class="activity-content-wrapper">
            <div class="activity-navbar">
                <a href="#" class="activity-link active" data-filter="my_posts">{{ profile_user.username }}ë‹˜ì˜ ê¸€</a>
            </div>

            <div id="activity-content" class="activity-content">
                <!-- AJAX -->
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let currentFilter = 'my_posts';
        let currentCategory = 'all';
        const userId = "{{ profile_user.id }}";
    
        loadActivities(currentFilter, currentCategory, userId);
    
        const activityLinks = document.querySelectorAll('.activity-link');
        const filterLinks = document.querySelectorAll('.filter-link');

        activityLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                currentFilter = this.getAttribute('data-filter');
                activityLinks.forEach(link => link.classList.remove('active'));
                this.classList.add('active');
                loadActivities(currentFilter, currentCategory, userId);
            });
        });

        filterLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                currentCategory = this.getAttribute('data-category');
                filterLinks.forEach(link => link.classList.remove('active'));
                this.classList.add('active');
                loadActivities(currentFilter, currentCategory, userId);
            });
        });

        function loadActivities(filter, category, userId) {
            const url = `{% url 'mypage:ajax_activities' %}?filter=` + filter + `&category=` + category + `&user_id=` + userId;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const activityContent = document.getElementById('activity-content');
                    activityContent.innerHTML = '';

                    if (data.posts.length > 0) {
                        const randomImage = "{% static 'images/' %}{{ random_image }}";  // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©
                    
                        data.posts.forEach(post => {
                            const postElement = document.createElement('div');
                            postElement.classList.add('activity-card');
                            postElement.innerHTML = `
                                <div class="card-image" style="background-image: url('${randomImage}');"></div>
                                <div class="card-content">
                                    <h3><a href="${post.url}">${post.title}</a></h3>
                                    <span>ì‘ì„±ì: ${post.writer}</span>
                                    <span>ë‚ ì§œ: ${new Date(post.date).toLocaleDateString()}</span>
                                </div>
                            `;
                            activityContent.appendChild(postElement);
                        });
                    } else {
                        activityContent.innerHTML = '<p>í•´ë‹¹í•˜ëŠ” ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                })
                .catch(error => console.error('Error loading activities:', error));
        }
    });
</script>
{% endblock %}